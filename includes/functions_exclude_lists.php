<?php/*** Return part of sql query with user ids that we need to exclude.*/function get_exclude_list_user_id_sql($email_list_array, $exclude_lists_arr){	global $mysqli;		$exclude_query = "";	if (is_array($email_list_array) && count($email_list_array) > 0 && is_array($exclude_lists_arr) && count($exclude_lists_arr) > 0)	{		$exclude_user_ids_arr = array();		//self joined table as shown in http://www.lornajane.net/posts/2012/sql-joining-a-table-to-itself		/*SELECT incl.id as include_id, excl.id as exclude_id, incl.email as include_email, excl.email as exclude_email FROM subscribers incl inner join subscribers excl on incl.email = excl.emailWHERE incl.list in (28, 144) AND excl.list in (143, 145) AND incl.unsubscribed = 0 AND incl.bounced = 0 AND incl.complaint = 0 AND incl.confirmed = 1				*/		$exclude_join_sql = '		SELECT incl.id as include_id, excl.id as exclude_id, incl.email as include_email, excl.email as exclude_email 		FROM subscribers incl 		inner join subscribers excl on incl.email = excl.email		WHERE incl.list in ('.implode(',', $email_list_array).') AND excl.list in ('.implode(',', $exclude_lists_arr).') AND incl.unsubscribed = 0 AND incl.bounced = 0 AND incl.complaint = 0 AND incl.confirmed = 1';				$r = mysqli_query($mysqli, $exclude_join_sql);		if ($r)		{			while($row = mysqli_fetch_array($r))			{				$exclude_user_ids_arr[] = $row['include_id'];			}  		}					if (count($exclude_user_ids_arr) > 0)		{			$exclude_user_ids_arr = array_unique($exclude_user_ids_arr);			$exclude_query = " AND id not in (".implode(',', $exclude_user_ids_arr).") ";		}	}		return $exclude_query;}